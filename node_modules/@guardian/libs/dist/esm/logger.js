/**
 *
 * Handles team-based logging to the browser console
 *
 * Prevents a proliferation of console.log in client-side
 * code.
 *
 * Subscribing to logs relies on LocalStorage
 */
var _a;
import { teams } from './logger.teams';
import { storage } from './storage';
const KEY = 'gu.logger';
const teamColours = teams;
const style = (team) => {
    const { background, font } = teamColours[team];
    return `background: ${background}; color: ${font}; padding: 2px; border-radius:3px`;
};
/**
 * Only logs in dev environments.
 */
export const debug = (team, ...args) => {
    const isDevEnv = window.location.host.includes('localhost') ||
        window.location.host.endsWith('thegulocal.com') ||
        window.location.host.endsWith('.dev-theguardian.com');
    if (isDevEnv)
        log(team, ...args);
};
/**
 * Runs in all environments, if local storage values are set.
 */
export const log = (team, ...args) => {
    // TODO add check for localStorage
    if (!(storage.local.get(KEY) || '').includes(team))
        return;
    const styles = [style('common'), '', style(team), ''];
    console.log(`%c@guardian%c %c${team}%c`, ...styles, ...args);
};
/**
 * Subscribe to a teamâ€™s log
 * @param team the teamâ€™s unique ID
 */
const subscribeTo = (team) => {
    const teamSubscriptions = storage.local.get(KEY)
        ? storage.local.get(KEY).split(',')
        : [];
    teamSubscriptions.push(team);
    storage.local.set(KEY, teamSubscriptions.join(','));
    log(team, 'ðŸ”” Subscribed, hello!');
};
/**
 * Unsubscribe to a teamâ€™s log
 * @param team the teamâ€™s unique ID
 */
const unsubscribeFrom = (team) => {
    log(team, 'ðŸ”• Unsubscribed, good-bye!');
    const teamSubscriptions = storage.local.get(KEY)
        .split(',')
        .filter((t) => t !== team);
    storage.local.set(KEY, teamSubscriptions.join(','));
};
if (typeof window !== 'undefined') {
    window.guardian || (window.guardian = {});
    (_a = window.guardian).logger || (_a.logger = {
        subscribeTo,
        unsubscribeFrom,
        teams: () => Object.keys(teamColours),
    });
}
export const _ = {
    teamColours,
    KEY,
};
